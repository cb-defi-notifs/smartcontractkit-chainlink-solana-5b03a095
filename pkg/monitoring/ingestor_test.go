package monitoring

import (
	"testing"

	"github.com/gagliardetto/solana-go"
	"github.com/gagliardetto/solana-go/rpc/ws"
)

func TestIngestor(t *testing.T) {
	fakeLogResult := &ws.LogResult{
		Context: struct {
			Slot uint64
		}{
			Slot: 0x8423af2,
		},
		Value: struct {
			Signature solana.Signature "json:\"signature\""
			Err       interface{}      "json:\"err\""
			Logs      []string         "json:\"logs\""
		}{
			Signature: solana.Signature{0x51, 0x61, 0x20, 0x6c, 0x7f, 0xaf, 0x88, 0x5, 0x9c, 0x2f, 0xe5, 0xf7, 0xe3, 0xf3, 0xb3, 0xc3, 0xdf, 0xf1, 0x65, 0x16, 0x38, 0x51, 0x28, 0x97, 0x59, 0x88, 0x87, 0x9e, 0x4b, 0x12, 0x36, 0x4f, 0x15, 0xb0, 0x3e, 0xf8, 0x35, 0xc6, 0xea, 0xbe, 0x2f, 0xa2, 0x13, 0xc3, 0x3c, 0x4c, 0x5e, 0xfb, 0xa2, 0x1, 0x41, 0x88, 0x98, 0x4c, 0xad, 0x9c, 0x88, 0xce, 0xe3, 0x16, 0xfc, 0x5a, 0xa8, 0x5},
			Err:       interface{}(nil),
			Logs: []string{
				"Program cjg3oHmg9uuPsP8D6g29NWvhySJkdYdAo9D25PRbKXJ invoke [1]",
				"Program data: gjbLTR5rT6j9IRcAAAM0cArd3JbxinfsblA0z3qwRRlKQpralO0xSE8aPrh4zfUFAAAAAAAAAAAAAAAADW77smIPAwkHCgQPBgAMCw4BBQ0CAAAAAMxmujUBAAAAfWUAAAAAAAA=",
				"Program HEvSKofvBgfaexv23kMabbYqxasxU3mQ4ibBMEmJWHny invoke [2]",
				"Program log: Instruction: Submit",
				"Program HEvSKofvBgfaexv23kMabbYqxasxU3mQ4ibBMEmJWHny consumed 3461 of 1212284 compute units",
				"Program HEvSKofvBgfaexv23kMabbYqxasxU3mQ4ibBMEmJWHny success",
				"Program cjg3oHmg9uuPsP8D6g29NWvhySJkdYdAo9D25PRbKXJ consumed 191737 of 1400000 compute units",
				"Program cjg3oHmg9uuPsP8D6g29NWvhySJkdYdAo9D25PRbKXJ success",
			},
		},
	}
	expectedMappedLog := map[string]interface{}{
		"err":                "",
		"events":             []interface{}{},
		"program_public_key": []uint8{0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0},
		"signature":          []uint8{0x51, 0x61, 0x20, 0x6c, 0x7f, 0xaf, 0x88, 0x5, 0x9c, 0x2f, 0xe5, 0xf7, 0xe3, 0xf3, 0xb3, 0xc3, 0xdf, 0xf1, 0x65, 0x16, 0x38, 0x51, 0x28, 0x97, 0x59, 0x88, 0x87, 0x9e, 0x4b, 0x12, 0x36, 0x4f, 0x15, 0xb0, 0x3e, 0xf8, 0x35, 0xc6, 0xea, 0xbe, 0x2f, 0xa2, 0x13, 0xc3, 0x3c, 0x4c, 0x5e, 0xfb, 0xa2, 0x1, 0x41, 0x88, 0x98, 0x4c, 0xad, 0x9c, 0x88, 0xce, 0xe3, 0x16, 0xfc, 0x5a, 0xa8, 0x5}, "slot": []uint8{0x0, 0x0, 0x0, 0x0, 0x8, 0x42, 0x3a, 0xf2},
	}
}
